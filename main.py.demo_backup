import streamlit as st
import os
import time
from datetime import datetime
import sys

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É –≤ –ø—É—Ç–∏ –ø–æ–∏—Å–∫–∞ Python
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

st.set_page_config(
    page_title="ü§ñ Team AI Assistant",
    page_icon="ü§ñ", 
    layout="wide",
    initial_sidebar_state="expanded"
)

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.title("ü§ñ Team AI Assistant")
st.write("–í–∞—à –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–Ω–∞–Ω–∏—è–º–∏ –∫–æ–º–∞–Ω–¥—ã")

# –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π
with st.sidebar:
    st.header("üì§ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é")
    
    # –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Ñ–∞–º–∏–ª–∏–∏ –∞–≤—Ç–æ—Ä–∞
    author = st.text_input("üë§ –í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è:", placeholder="–ò–≤–∞–Ω–æ–≤–∞")
    
    # –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    info_type = st.selectbox("–¢–∏–ø –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:", 
                           ["–ü—Ä–æ—Ü–µ—Å—Å/–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", "–ü—Ä–æ–µ–∫—Ç/–°—Å—ã–ª–∫–∏", "–î–æ—Å—Ç—É–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞", "–î—Ä—É–≥–æ–µ"])
    
    if not author:
        st.warning("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é")
    
    # –§–æ—Ä–º—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    if info_type == "–ü—Ä–æ—Ü–µ—Å—Å/–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è":
        st.subheader("üìã –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å")
        process_name = st.text_input("–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞:")
        steps = st.text_area("–®–∞–≥–∏ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É):", height=150,
                           placeholder="1. –ü–µ—Ä–≤—ã–π —à–∞–≥\n2. –í—Ç–æ—Ä–æ–π —à–∞–≥\n3. –¢—Ä–µ—Ç–∏–π —à–∞–≥")
        tags = st.text_input("–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):", placeholder="#–ø–æ—Å—Ç–∞–≤–∫–∞ #–¥–µ–ø–ª–æ–π")
        
        if st.button("‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å") and author:
            if process_name and steps:
                new_text = f"""[–¢–ò–ü]: –ü—Ä–æ—Ü–µ—Å—Å
[–ù–ê–ó–í–ê–ù–ò–ï]: {process_name}
[–®–ê–ì–ò]:
{steps}
[–¢–ï–ì–ò]: {tags}
"""
                st.success("‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω! (–†–µ–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)")
                time.sleep(1)
                st.rerun()
            else:
                st.warning("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —à–∞–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞")
    
    elif info_type == "–ü—Ä–æ–µ–∫—Ç/–°—Å—ã–ª–∫–∏":
        st.subheader("üîó –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç")
        project_name = st.text_input("–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:")
        links = st.text_area("–°—Å—ã–ª–∫–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ: —Å—Å—ã–ª–∫–∞):", height=150,
                          placeholder="OpenShift: https://console.openshift.com\nGrafana: https://grafana.com")
        description = st.text_area("–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:")
        tags = st.text_input("–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):", placeholder="#–ø—Ä–æ–º #–±–ª–æ–∫1")
        
        if st.button("‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç") and author:
            if project_name:
                new_text = f"""[–¢–ò–ü]: –ü—Ä–æ–µ–∫—Ç  
[–ù–ê–ó–í–ê–ù–ò–ï]: {project_name}
[–°–°–´–õ–ö–ò]:
{links}
[–û–ü–ò–°–ê–ù–ò–ï]: {description}
[–¢–ï–ì–ò]: {tags}
"""
                st.success("‚úÖ –ü—Ä–æ–µ–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω! (–†–µ–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)")
                time.sleep(1)
                st.rerun()
            else:
                st.warning("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞")
    
    elif info_type == "–î–æ—Å—Ç—É–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞":
        st.subheader("üë• –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø")
        employee = st.text_input("–§–∞–º–∏–ª–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:")
        system = st.text_input("–°–∏—Å—Ç–µ–º–∞/–†–µ—Å—É—Ä—Å:")
        date = st.text_input("–î–∞—Ç–∞ –¥–æ—Å—Ç—É–ø–∞:", placeholder=datetime.now().strftime('%Y-%m-%d'))
        comment = st.text_area("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:")
        tags = st.text_input("–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):", placeholder="#–¥–æ—Å—Ç—É–ø #crm")
        
        if st.button("‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø") and author:
            if employee and system:
                new_text = f"""[–¢–ò–ü]: –î–æ—Å—Ç—É–ø
[–°–û–¢–†–£–î–ù–ò–ö]: {employee}
[–°–ò–°–¢–ï–ú–ê]: {system}
[–î–ê–¢–ê]: {date if date else datetime.now().strftime('%Y-%m-%d')}
[–ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô]: {comment}
[–¢–ï–ì–ò]: {tags}
"""
                st.success("‚úÖ –î–æ—Å—Ç—É–ø –¥–æ–±–∞–≤–ª–µ–Ω! (–†–µ–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)")
                time.sleep(1)
                st.rerun()
            else:
                st.warning("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏ —Å–∏—Å—Ç–µ–º—É")
    
    else:
        st.subheader("üìù –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
        title = st.text_input("–ó–∞–≥–æ–ª–æ–≤–æ–∫:")
        content = st.text_area("–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:", height=200)
        tags = st.text_input("–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):")
        
        if st.button("üìù –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é") and author:
            if content:
                filename = f"info_{title.lower().replace(' ', '_')}.txt" if title else "user_input.txt"
                new_text = f"""[–¢–ò–ü]: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
[–ó–ê–ì–û–õ–û–í–û–ö]: {title}
[–°–û–î–ï–†–ñ–ê–ù–ò–ï]: {content}
[–¢–ï–ì–ò]: {tags}
"""
                st.success("‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞! (–†–µ–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)")
                time.sleep(1)
                st.rerun()
            else:
                st.warning("–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏")

# –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–æ–ø—Ä–æ—Å–æ–≤
st.header("üí¨ –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å")
question = st.text_input("–í–∞—à –≤–æ–ø—Ä–æ—Å:", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ—Å—Ç–∞–≤–∫–∏?")

if question:
    with st.spinner("ü§î –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏—â–µ—Ç –æ—Ç–≤–µ—Ç..."):
        time.sleep(2)  # –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
        
        st.success("‚úÖ –û—Ç–≤–µ—Ç:")
        st.write(f"–ù–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å '{question}' —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–π–¥–µ—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.")
        st.info("‚ö†Ô∏è –†–µ–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö")
        
        # –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        st.write("""
        **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã:**
        1. –ü–æ–∏—Å–∫ –ø–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
        2. –ê–Ω–∞–ª–∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é GigaChat
        3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        4. –£–∫–∞–∑–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        """)

st.write("---")
st.info("üí° **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –î–æ–±–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –∏ –∑–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã!")
